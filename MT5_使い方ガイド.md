# MT5版インジケーター・EA 使い方ガイド

## 📦 作成したファイル

1. **MyIndicator_MT5.mq5** - インジケーター版
2. **MyStrategy_MT5.mq5** - EA（自動売買）版

---

## 🔧 インストール方法

### 1. MetaTrader 5にファイルをコピー

```
方法A: MetaEditorから直接
1. MT5を開く
2. メニュー > ツール > MetaQuotes Language Editor (F4)
3. 新規 > インジケーター（またはExpert Advisor）
4. 作成したコードをコピー＆ペースト
5. コンパイル（F7）

方法B: ファイルを直接配置
1. MT5のデータフォルダを開く
   - ファイル > データフォルダを開く
2. インジケーター: MQL5/Indicators/ にコピー
3. EA: MQL5/Experts/ にコピー
4. MetaEditorで開いてコンパイル（F7）
```

### 2. コンパイルエラーがないか確認

- 「0 error(s), 0 warning(s)」と表示されればOK
- エラーが出た場合は、MT5のバージョンを確認

---

## 📊 MyIndicator_MT5.mq5 の使い方

### 機能一覧

✅ **SuperTrend** - トレンド方向と反転を表示
✅ **マルチタイムフレームMA** - 4時間足、日足、週足の移動平均線
✅ **ボリンジャーバンド** - ±1σ、±2σ表示
✅ **前日高値安値** - 自動的に水平線を引く

### チャートに追加

```
1. ナビゲーター > インジケータ > カスタム
2. 「自作インジケーター MT5」を探す
3. チャートにドラッグ＆ドロップ
```

### パラメータ設定

#### SuperTrend設定
- **ATR期間**: 9（デフォルト）
- **ATR乗数**: 3.9（大きいほどトレンド転換が遅い）
- **SuperTrend表示**: ON/OFF切り替え

#### マルチタイムフレームMA
- **MTF MA表示**: ON/OFF切り替え
- **MA期間**: 20（デフォルト）
- **MA種類**: EMA/SMA選択可能

#### ボリンジャーバンド
- **BB表示**: ON/OFF切り替え
- **BB期間**: 21（デフォルト）
- **BB偏差**: 2.0（標準偏差の倍率）

#### 前日高値安値
- **表示**: ON/OFF切り替え
- **前日高値色**: 緑（デフォルト）
- **前日安値色**: 赤（デフォルト）

### 色の設定

チャート上で右クリック > プロパティ > 色の設定
各ラインの色と太さを変更可能

---

## 🤖 MyStrategy_MT5.mq5 の使い方

### 戦略ロジック

**エントリーシグナル**
- SuperTrendの反転（上昇/下降）
- または移動平均線のゴールデンクロス/デッドクロス
- トレンドフィルター適用（200EMA）

**エグジット**
- リスクリワード比（デフォルト: 1:3）
- ATRベースのストップロス
- 部分利確（1.5Rで50%決済）

### チャートに追加

```
1. ナビゲーター > エキスパートアドバイザ
2. 「自作ストラテジー MT5」を探す
3. チャートにドラッグ＆ドロップ
4. 自動売買を許可（上部の「アルゴリズム取引」ボタンを緑に）
```

### 重要な設定

#### SuperTrend設定
- **ATR期間**: 9
- **ATR乗数**: 3.9

#### 移動平均設定
- **短期MA期間**: 20
- **長期MA期間**: 75
- **MA種類**: SMA/EMA

#### リスク管理（最重要！）
- **リスク%**: 1.0（資金の1%をリスク）
- **ATR SL倍率**: 1.5
- **リスクリワード比**: 3.0（1:3）
- **最小利確PIPS**: 20
- **ATRベースSL/TP使用**: ON推奨
- **部分利確有効**: ON推奨
- **部分利確R倍率**: 1.5（1.5Rで50%決済）

#### フィルター
- **トレンドフィルター使用**: ON推奨
- **トレンド判定時間足**: H4（4時間足）
- **トレンドEMA期間**: 200

#### 取引設定
- **ロットサイズ**: 0.1（固定ロット時）
- **リスクベースサイジング使用**: ON推奨
- **マジックナンバー**: 123456（他のEAと区別）
- **注文コメント**: MyStrategy

---

## ⚠️ バックテスト方法

### ストラテジーテスターで検証

```
1. 表示 > ストラテジーテスター（Ctrl+R）
2. エキスパートアドバイザ: MyStrategy_MT5を選択
3. 通貨ペア: USD/JPY、EUR/USDなど
4. 時間足: M15〜H1推奨
5. 期間: 2020-01-01 〜 現在
6. モデル: 全ティック（最も正確）
7. 開始ボタンをクリック
```

### 結果の見方

- **勝率**: 60%以上が理想
- **プロフィットファクター**: 1.5以上が良好
- **最大ドローダウン**: 20%以下が望ましい
- **総トレード数**: 100回以上でデータ信頼性向上

### パラメータ最適化

```
1. ストラテジーテスター > 設定 > 最適化タブ
2. 最適化するパラメータにチェック
   - ATR乗数: 2.0〜5.0（ステップ0.5）
   - リスクリワード比: 2.0〜5.0（ステップ0.5）
   - 短期MA: 10〜30（ステップ5）
   - 長期MA: 50〜100（ステップ10）
3. 「遺伝的アルゴリズム」を選択
4. 開始ボタンをクリック
```

---

## 🎯 推奨設定

### 初心者向け（保守的）
```
【SuperTrend】
- ATR乗数: 4.0〜5.0（ノイズ減）

【リスク管理】
- リスク%: 0.5%
- リスクリワード比: 3.0〜4.0
- トレンドフィルター: ON
- 部分利確: ON

【通貨ペア】
- USD/JPY, EUR/USD（メジャー通貨推奨）

【時間足】
- H1（1時間足）
```

### 中級者向け（バランス型）
```
【SuperTrend】
- ATR乗数: 3.5〜4.0

【リスク管理】
- リスク%: 1.0%
- リスクリワード比: 2.5〜3.0
- トレンドフィルター: ON
- 部分利確: ON

【通貨ペア】
- メジャー通貨 + クロス円

【時間足】
- M30〜H1
```

### 積極的（高頻度）
```
【SuperTrend】
- ATR乗数: 3.0〜3.5

【リスク管理】
- リスク%: 1.0〜2.0%
- リスクリワード比: 2.0〜3.0
- トレンドフィルター: OFF
- 部分利確: ON

【通貨ペア】
- ボラティリティの高い通貨ペア

【時間足】
- M15〜M30
```

---

## 🔍 トラブルシューティング

### コンパイルエラー

**エラー: 'INVALID_HANDLE' undeclared identifier**
→ MT5のバージョンが古い可能性。最新版にアップデート

**エラー: 'ArraySetAsSeries' unknown function**
→ コードの先頭に `#property strict` を追加

### EAが動かない

1. **アルゴリズム取引が有効か確認**
   - チャート上部の「アルゴリズム取引」ボタンが緑色になっているか

2. **ログを確認**
   - ツールボックス > エキスパート タブ
   - エラーメッセージがないか確認

3. **口座の証拠金が十分か**
   - 最低でもロットサイズの10倍以上の証拠金推奨

4. **通貨ペアの取引時間**
   - 週末や市場休場時は取引不可

### インジケーターが表示されない

1. **チャートを右クリック > プロパティ**
   - 「すべての時間軸で表示」にチェック

2. **表示設定を確認**
   - パラメータで各要素のON/OFFを確認

---

## 📝 注意事項

⚠️ **リアル口座での使用前に必ずバックテストとデモ口座での検証を行ってください**

⚠️ **過去の成績が将来の成績を保証するものではありません**

⚠️ **リスク管理を徹底し、資金の1〜2%以下のリスクで運用してください**

⚠️ **経済指標発表時などの急変動時は自動売買を停止することを推奨します**

---

## 🆘 サポート

問題が発生した場合：

1. MT5のバージョンを確認（ビルド 3000以上推奨）
2. コードを再コンパイル
3. MT5を再起動
4. デモ口座でテスト

---

## 📊 バックテスト結果の例（参考）

```
通貨ペア: USD/JPY
時間足: H1
期間: 2020-01-01 〜 2024-12-31
設定: デフォルト（リスク1%、RR比3.0）

期待される結果:
- 勝率: 55〜65%
- プロフィットファクター: 1.5〜2.5
- 最大ドローダウン: 10〜20%
- 年間リターン: 20〜50%

※実際の結果は市場環境により大きく異なります
```

---

## 🎓 次のステップ

1. **バックテストで最適パラメータを見つける**
2. **デモ口座で1ヶ月以上運用**
3. **リアル口座で小ロットから開始**
4. **定期的に成績を見直し、必要に応じてパラメータ調整**

**成功を祈ります！**
